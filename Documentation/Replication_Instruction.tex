% Article Format: American Economic Review
% Xin Tang @ Stony Brook University
% Last Updated: August 2014
\documentclass[twoside,11pt,leqno]{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Text Layout                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page Layout
\usepackage[hmargin={1.2in,1.2in},vmargin={1.5in,1.5in}]{geometry}
\topmargin -1cm        % read Lamport p.163
\oddsidemargin 0.04cm   % read Lamport p.163
\evensidemargin 0.04cm  % same as oddsidemargin but for left-hand pages
\textwidth 16.59cm
\textheight 21.94cm
\renewcommand\baselinestretch{1.15}
\parskip 0.25em
\parindent 1em
\linespread{1}

% Set header and footer
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[LE,RO]{\thepage}
\fancyhead[CE]{\textit{AMERICAN ECONOMIC JOURNAL: MACROECONOMICS}}
\fancyhead[CO]{\textit{QI ET AL.: FIRM SIZE DISTRIBUTION AND POLLUTION REPLICATION}}
\cfoot{}
\renewcommand{\headrulewidth}{0pt}
%\renewcommand*\footnoterule{}
%\setcounter{page}{1}

% Font
\renewcommand{\rmdefault}{ptm}
\renewcommand{\sfdefault}{phv}
%\usepackage[lite]{mtpro2}
% use Palatinho-Roman as default font family
%\renewcommand{\rmdefault}{ppl}
\usepackage[scaled=0.88]{helvet}
\makeatletter   % Roman Numbers
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\makeatother
\usepackage{CJK}

% Section Titles
\renewcommand\thesection{\textnormal{\textbf{\Roman{section}.}}}
\renewcommand\thesubsection{\textnormal{\Alph{subsection}.}}
\usepackage{titlesec}
\titleformat*{\section}{\bf \center}
\titleformat*{\subsection}{\it \center}
\renewcommand{\refname}{\textnormal{REFERENCES}}

% Appendix
\usepackage[title]{appendix}
\renewcommand{\appendixname}{APPENDIX}

% Citations
\usepackage[authoryear,comma]{natbib}
\renewcommand{\bibfont}{\small}
\setlength{\bibsep}{0em}
\usepackage[%dvipdfmx,%
            bookmarks=true,%
            pdfstartview=FitH,%
            breaklinks=true,%
            colorlinks=true,%
            %allcolors=black,%
            citecolor=blue,
            linkcolor=red,
            pagebackref=true]{hyperref}

% Functional Package
\usepackage{enumerate, enumitem}
\usepackage{url}      % This package helps to typeset urls

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Mathematics                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{amsmath,amssymb,amsfonts,amsthm,mathrsfs,upgreek}
% Operators
\newcommand{\E}{\mathbb{E}}
\newcommand{\e}{\mathrm{e}}
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\plim}{plim}
\renewcommand{\vec}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\gvec}[1]{{\boldsymbol{#1}}}

\newcommand{\code}{\texttt}
\newcommand{\bcode}[1]{\texttt{\blue{#1}}}
\newcommand{\rcode}[1]{\texttt{\red{#1}}}
\newcommand{\rtext}[1]{{\red{#1}}}
\newcommand{\btext}[1]{{\blue{#1}}}

% New Environments
\newtheorem{result}{Result}
\newtheorem{assumption}{Assumption}
\newtheorem{proposition}{Proposition}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{definition}{Definition}
\setlength{\unitlength}{1mm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 Tables and Figures                   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{threeparttable,booktabs,multirow,array} % This allows notes in tables
\usepackage{floatrow} % For Figure Notes
\floatsetup[table]{capposition=top}
\usepackage[font={sc,footnotesize}]{caption}
\DeclareCaptionLabelSeparator{aer}{---}
\captionsetup[table]{labelsep=aer}
\captionsetup[figure]{labelsep=period}
\usepackage{graphicx,pstricks,epstopdf}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 Insert Code Snippet                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{listings,textcomp,upquote}
\lstset{
     language=fortran,
     frame = single,
%     backgroundcolor=\color[RGB]{255,228,202}, % pink
     backgroundcolor=\color[RGB]{231,240,233}, % green
%     backgroundcolor=\color[RGB]{239,240,248},
     framerule=0pt,
     showstringspaces=false,
     basicstyle=\ttfamily\footnotesize,
     numbers=left,
     stepnumber=1,
     numberstyle=\tiny,
     keywordstyle=\color{blue}\ttfamily,
     stringstyle=\color{red}\ttfamily,
     commentstyle=\color[rgb]{.133,.545,.133}\ttfamily,
     morecomment=[l][\color{magenta}]{\#},
     fontadjust,
     captionpos=t,
     framextopmargin=2pt,framexbottommargin=2pt,
     abovecaptionskip=4ex,belowcaptionskip=3pt,
     belowskip=3pt,
     framexleftmargin=4pt,
     xleftmargin=4em,xrightmargin=4em,
     texcl=false,
     extendedchars=false,columns=flexible,mathescape=true,
     captionpos=b,
}
\renewcommand{\lstlistingname}{Source Code}

\title{\vspace{-1cm}\Large{\textsf{The Size Distribution of Firms and Industrial Water Pollution: A Quantitative Analysis of China} \\ \textsf{Replication Instructions}}}
\author{
  \normalsize{{Ji Qi}} \\
  \normalsize{{Chinese Academy of Environmental Science}}
  \and
  \normalsize{{Xin Tang}}\footnote{Please send all correspondence to: zjutangxin@gmail.com} \\
  \normalsize{{Wuhan University}} \\
  \normalsize{{International Monetary Fund}}
  \and
  \normalsize{{Xican Xi}} \\
  \normalsize{{Fudan University}}
}
\date{\normalsize\today}

\begin{document}
\maketitle

This note explains step-by-step how to replicate all the results in \textit{The Size Distribution of Firms and Industrial Water Pollution: A Quantitative Analysis of China}. We begin with some housekeeping stuff in Section \rom{1}. Section \rom{2} explains in detail how to replicate all the results in the main text. Section \rom{3} shows how the results in the appendices can be replicated. The data and code can be downloaded from the AEA Data and Code Repository (OPENICPSR-112005).

\section{Housekeeping Information}

\subsection{Overview}

To replicate all the results in the paper, three softwares are used. Specifically, \textsc{Stata} is used for initial data processing. All the empirical results are then produced using \code{R}. MATLAB is used to compute all the quantitative results. There is no particular scientific reason that we use one statistical software (\textsc{Stata}) for data cleaning and the other (\code{R}) for empirical analysis. Veterans of \textsc{Stata} or \code{R} should be able to replicate all the empirical results with just one software using our source code as reference with ease. In addition, it should go without saying that for readers without a licence to MATALB, GNU Octave could be used instead.

The specific versions we use are: \textsc{Stata} 12, \texttt{R} 3.5.3 (code name \textit{Great Truth}) and MATLAB R2016a. The readers may need to do some very minor syntax change if using other versions. None of our results should be affected though. We did test our code in other versions of the softwares to the best as we could. Below are two examples:
\begin{itemize}
    \item
    Due to limited backward compatibility of \textsc{Stata} and that the \code{foreign} package of \code{R} supports only \code{.dta} files saved by \textsc{Stata} up to Version 12, readers with more recent version of \textsc{Stata} would need to either modify in the \code{.do} file everywhere \code{.dta} files are read and written, or use alternative \code{R} package (for instance \code{readstata13}) to convert the data in \bcode{cpsc\_convert.R} and \bcode{cec\_convert.R}.
    \item
    The syntax for several routines was slightly changed in MATLAB R2014b. If vintage versions are used, the reader would get a complaint saying (here from R2014a for instance)
\begin{verbatim}    
Error using optimoptions (line 105)
'OptimalityTolerance' is not an option for FSOLVE.
A list of options can be found on the FSOLVE documentation page.
\end{verbatim}
    The code would run through by simply fixing the syntax to R2014a version; namely, the keywords to two optimization options need to be changed to \code{TolFun} and \code{MaxIter}. The code would then run through seamlessly.
\end{itemize}

We use three datasets in our analysis: The National General Survey of Pollution Sources (NGSPS, \begin{CJK}{GBK}{kai}第一次全国污染源普查\end{CJK}), The National Economic Census (CNEC, \begin{CJK}{GBK}{kai}第一次全国经济普查\end{CJK}) and the Statistics of U.S. Businesses (SUSB).
\begin{itemize}
    \item
    The NGSPS is a confidential dataset housed at the Ministry of Ecology and Environment (MEE henceforth). The dataset is subject to regulation by \textit{The Law of the People's Republic of China on Guarding State Secrets} (\begin{CJK}{GBK}{kai}中华人民共和国保守国家秘密法\end{CJK}) because it contains sensitive information. Please refer to \textit{Regulation on Archiving the National General Survey of Pollution Sources Data} (\textit{State Environmental Protection Administration [2007] No.187}, {\begin{CJK}{GBK}{kai}污染源普查档案管理办法[环发[2007]187号]\end{CJK}}). The data can only be accessed within the MEE as well as institutions under its direct supervision (\begin{CJK}{GBK}{kai}中华人民共和国生态环境部及其直属单位\end{CJK}). Researchers affiliated with these institutions should submit application for access following the internal procedure of the MEE. This is how we access the data.

    Individual researchers not affiliated with the MEE and institutions under its direct supervision need to submit the application through the official portal for requesting Information Access (\begin{CJK}{GBK}{kai} 政府信息公开\end{CJK}) by the MEE at the following url: \url{http://www.mee.gov.cn/weihu/201706/t20170625_416641.shtml}. The url is retrieved on September 15th, 2019 and may vary in the future. All applications are subject to official approval by the General Office of Ministry of Ecology and Environment (\begin{CJK}{GBK}{kai}中华人民共和国生态环境部办公厅\end{CJK}).

    For an official introduction to the NGSPS and declassified information at the aggregated level, interested readers could refer to the book \textit{Data Collection of the National General Survey of Pollution Sources} (\begin{CJK}{GBK}{kai}《污染源普查数据集》, 中国环境科学出版社, 2011\end{CJK}), which is publicly available. We provide a summary in English in Online Appendix A of our paper.
    \item
    The CNEC is also a confidential dataset belonging to National Bureau of Statistics of China. Many universities and institutions have legal copy of the dataset though. Our copy was obtained from Fudan University. \\ \rtext{MORE INFORMATION IS NEEDED HERE!!!!!!!!}
    \item
    The SUSB is publicly available from the Census Bureau's dedicated website. The url, retrieved on September 15th, 2019, and subject to possible change in the future, is \url{https://www.census.gov/programs-surveys/susb.html}.
\end{itemize}

In the replication files, we cannot provide micro-level data of the NGSPS and CNEC, due to non-disclosure agreements with the MEE and Fudan University. Therefore, we only post the source code that generates the results. However, to facilitate replication by the readers who have access to the datasets, we post the log files when running the analysis on our computer. More details on the log files are provided at the end of this note.

\subsection{File Structures}

The readers will get a number of files for replicating the results. To ease digestion, we briefly introduce the structure of the folders and files. As typographical convention, we use \bcode{blue computer modern typewriter} to indicate \bcode{folders} and \bcode{files}. The parent folder is referred to as \bcode{./}.
\begin{itemize}
    \item
    \bcode{./Empirical/}:
    \begin{itemize}
        \item
        \bcode{./Data/}: contains the raw and cleaned data.
        \item
        \bcode{./Results/}: contains all the figures and log-files.
        \item
        \bcode{./cpsc\_raw.do}: does initial processing of the NGSPS.
        \item
        \bcode{./cec\_clean.do}: does initial processing of the CNEC.
        \item
        \bcode{./cpsc\_convert.R}: converts the NGSPS to the binary format of \code{R}.
        \item
        \bcode{./cec\_convert.R}: converts the CNEC to the binary format of \code{R}.
        \item
        \bcode{./Empirical\_AEJ.R}: produces most empirical results in the main text.
        \item
        \bcode{./Empirical\_Appendix.R} produces most empirical results in the appendices.
        \item
        \bcode{./Accounting.R}: executes the accounting exercise.
        \item
        \bcode{./Descriptive.R}: computes some summary statistics of the NGSPS.
    \end{itemize}
    \item
    \bcode{./Quantitative/}
    \begin{itemize}
        \item
        \bcode{./Results/}: contains all the results and figures.
        \item
        \bcode{./twosectors.m}: computes the equilibrium of the two-sector model with perfect substitution used in the main text and saves the results in \bcode{.mat} format.
        \item
        \bcode{./fcn2.m}: computes the excess demand at a given vector of price; called by \bcode{twosectors.m}.
        \item
        \bcode{./generate\_tables\_main.m}: prints Tables 4, 5 and 6 in the main text.
        \item
        \bcode{./plot\_figures.m}: plots Figures 5 and 6 in the main text.
        \item
        \bcode{./twosectors\_ces.m}: computes the equilibrium of the two-sector model with constant elasticity of substitution used in Appendix J and saves the results in \bcode{.mat} format.
        \item
        \bcode{./fcnces.m}: computes the excess demand at a given vector of price; called by \\
        \bcode{twosectors\_ces.m}.
        \item
        \bcode{./generate\_tables\_appendix.m}: prints Table J.1 in Appendix J.
        \item
        \bcode{./misc.m}: draws Figure D.2 and computes the decomposition in Sections \rom{4}.A and \rom{4}.B of the main text.
    \end{itemize}
\end{itemize}

All the file reference in the source code is specified by relative position. Please set the working director of your software to the current folder that hosts the file. For example, if the package is saved locally at \bcode{C:/Users/AEJ/pollution\_rep/}, then to replicate the empirical results, the working directory of \textsc{Stata} and \code{R} should all be set to \bcode{C:/Users/AEJ/pollution\_rep/Empirical}, while the MATLAB working directory should be set to \bcode{C:/Users/AEJ/pollution\_rep/Quantitative} when replicating the quantitative results.

\subsection{Data Cleaning}

The NGSPS comes by 5 \textsc{Stata} \code{.dta} files. \bcode{keynum.dta} contains the information of the key sources, while \bcode{reg1.dta} to \bcode{reg4.dta} host the information of the regular sources. There are 4 files for the regular sources because of the technical limitation back when we initially applied for the data. It is likely that the reader will get one file for the regular source at this moment. These files should be placed under \bcode{./Empirical/Data/}. Executing \bcode{cpsc\_raw.do} will combine the four \bcode{regx.dta} to \bcode{regall.dta} and label all the variables in \bcode{keynum.dta} and \bcode{regall.dta}. It also generates another file \bcode{allfirms.dta} where the two files are combined. All three files are saved under \bcode{./Empirical/Data/}.

Our copy of the CNEC has two \textsc{Stata} \code{.dta} files. \bcode{cec2004\_large\_full.dta} holds those samples that overlap with the commonly used 2004 Annual Surveys of Industrial Firms (ASIF), while \bcode{cec2004\_small.dta} contains small firms not surveyed in the annual ASIF. Again, they should be placed under \bcode{./Empirical/Data/}. The file \bcode{cec\_clean.do} labels all the variables. Upon completion, the original un-labeled files will be replaced by files with the same name.

With these two steps completed, the reader needs to convert the data from \textsc{Stata} \code{.dta} format to the internal binary \code{R} format \code{.RData}. The file \bcode{cpsc\_convert.R} converts \bcode{keynum.dta} to \bcode{KEYFIRM\_R.RData}, \bcode{regall.dta} to \bcode{REGFIRM\_R.RData} and \bcode{allfirms.dta} to \bcode{ALLFIRM\_R.RData}. Similarly, \bcode{cec\_convert.R} converts \bcode{cec2004\_small.dta} to \bcode{DSMALL\_R.RData}, \bcode{cec2004\_large\_full.dta} to \bcode{DLARGE\_R.RData}. It then extracts only the variables used in the paper and combines the two \code{.RData} files to one file \\ \bcode{CNEC\_avgp.RData}. All the files are saved under \bcode{./Empirical/Data/} as before.

The SUSB data are directly downloaded from the Census website as \bcode{susb04.csv}. We use the dataset in its original form.

In what follows, we will only use the files converted by \code{R}. A list of the essential files is provided below. All the files should be placed under \bcode{./Empirical/Data/}. For ease of reference, we use the two-letter acronyms in parenthesis when referring to the data files later.
\begin{itemize}
    \item
    \bcode{KEYFIRM\_R.RData (PK)}: Key sources of the NGSPS.
    \item
    \bcode{ALLFIRM\_R.RData (PA)}: All sources of the NGSPS.
    \item
    \bcode{CNEC\_avgp.RData (CA)}: All samples in the CNEC.
    \item
    \bcode{DLARGE\_R.RData (DL)}: A subset of \code{CA} which overlaps with the 2004 ASIF.
    \item
    \bcode{susb04.csv (US)}: SUSB 2004.
\end{itemize}
Because we cannot post the NGSPS and CNEC publicly, the readers will not be able to run some of the files. Tables \ref{tab:navi_main} and \ref{tab:navi_appendix} list respectively which part of each file depends on which datasets and generates which results; the datasets are referenced using the above two-letter acronyms.

\section{Replicate Results in the Main Text}

We try to organize our source code by sections in the paper as much as we can. This is not always possible though (or creates unnecessary confusion). We do, however, break the code by sections within the file, where tasks that are reasonably connected logically are grouped together. The code is written such that each section is self-contained, so the readers do not have to run from the very beginning if she/he only wants to replicate a certain result.\footnote{That said, the readers should always check to ensure that all the functional packages of \code{R} are loaded.} Table \ref{tab:navi_main} summarizes the correspondence between the results in the paper (tables, figures, regression results, in-text numbers, etc.) and the section of code files that computes them, as well as data dependency. To further assist the readers to visually navigate through the code, important code snippets are always indicated by a 76-character line of \code{=}. This is the longest line in all the source code, and should be those most visually noticeable amongst all.

We now explain how to replicate the results in the main text step-by-step. The results are presented in the order of appearance in the main text.

\begin{table}[t]
\footnotesize
\centering
\begin{threeparttable}
\caption{Navigating the Main Text}
\begin{tabular}{llll}
    \hline \hline
    Content                         & File Name                  & File Dependency   & Location in Code \\
    \midrule
    \textbf{Section \rom{1}.A} \\
    \ \ \ Table 1                   & \bcode{Descriptive.R}      & \code{PK, PA} \\
    \textbf{Section \rom{1}.B} \\
    \ \ \ Figure 1                  & \bcode{Empirical\_AEJ.R}   & \code{PK}         & Section 1  \\
    \ \ \ Table 2                   & \bcode{Empirical\_AEJ.R}   & \code{PK}         & Section 2  \\
    \ \ \ Regression 1              & \bcode{Empirical\_AEJ.R}   & \code{PK}         & Section 1  \\
    \ \ \ Regressions 2, 3          & \bcode{Empirical\_AEJ.R}   & \code{PK}         & Section 2 \\
    \ \ \ Regression (!\#)          & \bcode{Empirical\_AEJ.R}   & \code{PK}         & Section 2 \\
    \textbf{Section \rom{1}.C} \\
    \ \ \ Figure 2                  & \bcode{Empirical\_AEJ.R}   & \code{CA, US}     & Section 3 \\
    \ \ \ Accounting                & \bcode{Accounting.R}       & \code{PK, CA, US} \\
    \textbf{Section \rom{2}.A} \\
    \ \ \ Figure 3                  & \bcode{Empirical\_AEJ.R}   & \code{CA}         & Section 4 \\
    \textbf{Section \rom{3}} \\
    \ \ \ Size Distribution         & \bcode{Empirical\_AEJ.R}   & \code{CA, US}     & Section 3 \\
    \ \ \ $\varphi_1$               & \bcode{Empirical\_AEJ.R}   & \code{CA} & Section 4 \\
    \ \ \ Clean share               & \bcode{Empirical\_AEJ.R}   & \code{PK} & Section 2 \\
    \ \ \ $k_E/Y$ for clean firms   & \bcode{Empirical\_AEJ.R}   & \code{PK} & Section 2 \\
    \ \ \ Figure 5                  & \bcode{twosectors.m}       & \multirow{2}{*}{\centering \code{*.mat}} \\
                                    & \bcode{plot\_figures.m} \\
    \textbf{Section \rom{4}.A} \\
    \ \ \ Table 4                   & \bcode{compute\_tables.m}  & \code{*.mat} \\
    \ \ \ Table 5                   & \bcode{compute\_tables.m}  & \code{*.mat} \\
    \ \ \ Figure 6                  & \bcode{plot\_figures.m}    & \code{*.mat} \\
    \ \ \ Decomposition             & \bcode{misc.m}             & \code{*.mat} \\
    \textbf{Section \rom{4}.B} \\
    \ \ \ Table 6                   & \bcode{compute\_tables.m}  & \code{*.mat} \\
    \ \ \ Decomposition             & \bcode{misc.m}             & \code{*.mat} \\
    \bottomrule
\end{tabular}
\label{tab:navi_main}
\begin{tablenotes}
     \footnotesize{
     \item[$\dagger$]
     Acronyms for datasets:
     \begin{itemize}[leftmargin=*]
        \item
        \bcode{KEYFIRM\_R.RData (PK)}: Key sources of the NGSPS.
        \item
        \bcode{ALLFIRM\_R.RData (PA)}: All sources of the NGSPS.
        \item
        \bcode{CNEC\_avgp.RData (CA)}: All samples in the CNEC.
        \item
        \bcode{susb04.csv (US)}: SUSB 2004.
     \end{itemize}
     }
     \item[$\ddag$]
     All the \code{*.mat} files will be produced by \bcode{twosectors.m}.
     \item[$\diamondsuit$]
     Notation (!\#) stands for ``un-numbered.''
\end{tablenotes}
\end{threeparttable}
\end{table}

\begin{enumerate}
    \item
    Table 1 is produced by the first part of \bcode{Descriptive.R}. All the numbers are printed to the terminal. Row 1 comes first, with Rows 2 and 3 follow in order.
    \item
    Regression (1) and Figure 1 are generated by Section 1 of \bcode{Empirical\_AEJ.R}. The regression results are printed to the terminal. Figure 1 is saved at \bcode{./Empirical/Results/Figure1.pdf}.
    \item
    Regressions (2), (3), and the un-numbered one in Section \rom{1}.B part \textit{The Role of End-of-pipe Treatment Technologies}, as well as Table 2 are produced by Section 2 of \bcode{Empirical\_AEJ.R}. As one exception, Section 2 relies on Section 1 of \bcode{Empirical\_AEJ.R}. The information in Table 2 is printed to the terminal in the order of Columns 2, 1, 3 and 4. The numbers in Columns 1 and 2 are directly taken from the output. Columns 3 and 4 are calculated by normalizing the physical equipment level to 100. Regression results are then printed to the terminal: first the unnumbered regression, with those of Regressions (2) and (3) follow in order.
    \item
    Figure 2 is produced by Section 3 of \bcode{Empirical\_AEJ.R}. The two panels are exported as \\ \bcode{./Empirical/Results/Figure2\_Left.pdf} and \bcode{Figure2\_Right.pdf}.
    \item
    The in-text number of the accounting exercise can be calculated from the results when executing \bcode{Accounting.R}. The 33\% reduction in the last paragraph of Section \rom{1}.C part \textit{An Accounting Exercise} can then be calculated as the weighted average of the variable \bcode{ppar} with Row 1 of Table 1 being the weight. Notice that the variable \bcode{ppar} is exactly Row 3 of Table F.1. Because according to Row 1 of Table 1, the five industries combined contribute to 77\% of total COD emission, assuming that industries emitting the other 23\% COD remain intact, the 25\% reduction in average intensity is simply calculated as $1 - (67\% \times 77\% + 100\% \times 23\%) \triangleq 25\%$. The calculation of the two numbers are automated in the code.
    \item
    Figure 3 is produced by the second part of Section 4 of \bcode{Empirical\_AEJ.R}. The two panels are exported as \bcode{./Empirical/Results/Figure3\_Left.pdf} and \bcode{Figure3\_Right.pdf}.
    \item
    To compute the quantitative results, the reader would need to execute \bcode{twosectors.m} several times. There are four cases to be computed: the benchmark case, the no distortion case, the regulation case and the flat tax case. The reader needs to manually set the parameters in \bcode{twosectors.m} for each cases, namely for the distortions \code{tauzd, tauzc}, the regulation intensity \code{xi} and the file name at the very end. The code is tuned to compute and save the benchmark results initially. The code contains all the relevant statements. Hence the reader only needs to comment and un-comment the relevant sections, which should be very easy to locate by searching the variable name.
    \begin{enumerate}
        \item
        Execute \bcode{twosectors.m}. Some information would be printed to the terminal. Please refer to the log file \bcode{quantitative\_main\_log.pdf} for details. The results are saved in \\ \bcode{./Quantitative/Results/benchmark\_new.mat}.
        \item
        Set \code{tauzd} and \code{tauzc} to zero, and the export destination to \bcode{./Results/notax\_new.mat}. The results will be saved in this file after execution. This case is labeled as Case (i) in the paper.
        \item
        Set \code{tauzd} and \code{tauzc} back to the benchmark level, change \code{xi} to 0.355, and the export destination to \bcode{./Results/regulation\_new.mat}. The results will be saved in this file after execution. This case is labeled as Case (ii) in the paper.
        \item
        Set \code{tauzd} and \code{tauzc} to the flat tax level, reverse \code{xi} back to 0.23, and set the export destination to \bcode{./Results/flattax\_new.mat}. The results will be saved in this file after execution. This case is labeled as Case (i') in the paper.
    \end{enumerate}
    \item
    With all the \code{*.mat} files computed, execute \bcode{plot\_figures.m} will produce Figures 5 and 6. The corresponding files will be saved under \bcode{./Quantitative/Results/}. The list of files include \\ \bcode{Figure5\_Left.pdf}, \bcode{Figure5\_Right.pdf}, \bcode{Figure6\_TopLeft.pdf}, \bcode{Figure6\_TopRight.pdf}, \\ \bcode{Figure6\_BotLeft.pdf} and \bcode{Figure6\_BotRight.pdf}.
    \item
    Similarly, file \bcode{generate\_tables\_main.m} reads the four \code{.mat} files and prints Tables 4, 5 and 6 to MATLAB terminal.
    %Tables 4, 5 and 6 are calculated using the output of \bcode{compute\_tables.m}. Notice that Tables 4 and 6 are presented in relative changes and share a similar structure. By changing the input files at the beginning of \bcode{compute\_tables.m} (in particular the 4 \code{.mat} just computed), \bcode{compute\_tables.m} prints the raw data of the corresponding entries in the same structure as the tables in the paper. Table 5 can be directly taken from the output \code{Table 5} after executing \bcode{compute\_tables.m} with the input being the corresponding cases. Entries in Table 4 can be calculated from the \code{Table 4} of the benchmark case and Cases (i) and (ii), while that of Table 6 can be calculated from \code{Table 4} of the benchmark case and Case (i'). The calculations of the relative changes are not automated, and the reader does have to do the calculations manually as we did. We apologize for the inconvenience.

    The in-text decomposition of total reduction to the contribution of size distribution and technology adoption can be performed using \bcode{misc.m}.\footnote{The code snippet \textit{must be} executed by using the MATLAB shortcut of 'Select $\rightarrow$ F9'. Executing \bcode{misc.m} by using the \textit{Run} command in MATLAB toolstrip would yield an error when calling the function \code{plot}. This is confirmed to be a known issue by staff from MathWorks. The supporting team claims that the issue has been fixed in MATLAB R2019b. We were not able to test the code under the environment.} The reader needs to change the second input file to either \bcode{notax\_new.mat} or \bcode{regulation\_new.mat}, depending on the case to compute. The role of technology adoption is printed to the terminal, with the residual being that from the size distribution.
    \item
    Several calibration targets are computed from the data as well. This last bulletin point explains where they are computed.
    \begin{itemize}
        \item
        The share of firms using clean technology 57\% is calculated in Section 2 of \bcode{Empirical\_AEJ.R}. The variable \code{clean\_share} hosts the number.
        \item
        The average adoption cost of clean technology as a ratio of output for clean firms 2.5\% is calculated at the end of Section 2 of \bcode{Empirical\_AEJ.R}. The number is printed to the terminal directly.
        \item
        The value of $\phi_1$ is computed in the first part of Section 4 of \bcode{Empirical\_AEJ.R}. The variable \code{phi\_quant} carries the information.
        \item
        The firm size and employment distributions [the light (yellow) bars in Figure 5] are computed at the end of Section 3 of \bcode{Empirical\_AEJ.R}. The variable \code{distchn} is first used to save the employment distribution and then the firm size distribution.
    \end{itemize}
\end{enumerate}

That concludes our instructions of replicating all the results in the main text.

\section{Replicate Results in the Appendices}

We now proceed with replicating the results in the appendices step-by-step. The results are presented in the order of appearance in the appendices. The correspondence between the results in the appendices and the section of code files is summarized in Table \ref{tab:navi_appendix}.

\begin{table}[t]
\footnotesize
\centering
\begin{threeparttable}
\caption{Navigating the Appendix}
\begin{tabular}{llll}
    \hline \hline
    Content                         & File Name                       & File Dependency          & Location in Code \\
    \midrule
    \textbf{Appendix A.1} \\
    \ \ \ Table A.1                 & \bcode{Descriptive.R}           & \code{PK, PA} \\
    \textbf{Appendix B} \\
    \ \ \ Figure B.1                & \bcode{Empirical\_Appendix.R}   & \code{PK, PA, DL, CA}    & Section 1  \\
    \textbf{Appendix C.1} \\
    \ \ \ Figure C.1                & \bcode{Empirical\_Appendix.R}   & \code{PK}                & Section 2  \\
    \ \ \ Table C.1                 & \bcode{Empirical\_Appendix.R}   & \code{PK}                & Section 2  \\
    \ \ \ Figure C.2                & \bcode{Empirical\_Appendix.R}   & \code{PK}                & Section 2  \\
    \ \ \ Regressions (!\#)         & \bcode{Empirical\_Appendix.R}   & \code{PK}                & Section 2  \\
    \ \ \ 3-Regressions (!\#)       & \bcode{Empirical\_AEJ.R}        & \code{PK}                & Section 2 \\
    \textbf{Appendix D.1} \\
    \ \ \ Figure D.1                & \bcode{Empirical\_Appendix.R}   & \code{CA}                & Section 4  \\
    \ \ \ Figure D.2                & \bcode{misc.m}                  & \code{*.mat} \\
    \textbf{Appendix D.2} \\
    \ \ \ Table D.1                 & \bcode{Empirical\_Appendix.R}   & \code{PK}                & Section 3  \\
    \ \ \ Regression (!\#)          & \bcode{Empirical\_Appendix.R}   & \code{PK}                & Section 3  \\
    \ \ \ Fixed Cost Ratio          & \bcode{Empirical\_Appendix.R}   & \code{PK}                & Section 3  \\
    \textbf{Appendix E.1} \\
    \ \ \ Figure E.1                & \bcode{Empirical\_Appendix.R}   & \code{CA, US}            & Section 5  \\
    \textbf{Appendix F} \\
    \ \ \ Table F.1                 & \bcode{Accounting.R}            & \code{PK, CA, US}  \\
    \textbf{Appendix J} \\
    \ \ \ Table J                   & \bcode{twosectors\_ces.m}       & \multirow{2}{*}{\centering \code{*.mat}} \\
                                    & \bcode{compute\_tables\_ces.m} \\
    \bottomrule
\end{tabular}
\label{tab:navi_appendix}
\begin{tablenotes}
     \footnotesize{
     \item[$\dagger$]
     Acronyms for datasets:
     \begin{itemize}[leftmargin=*]
        \item
        \bcode{KEYFIRM\_R.RData (PK)}: Key sources of the NGSPS.
        \item
        \bcode{ALLFIRM\_R.RData (PA)}: All sources of the NGSPS.
        \item
        \bcode{CNEC\_avgp.RData (CA)}: All samples in the CNEC.
        \item
        \bcode{DLARGE\_R.RData (DL)}: A subset of \code{CA} which overlaps with the 2004 Annual Surveys of Industrial Firm.
        \item
        \bcode{susb04.csv (US)}: SUSB 2004.
     \end{itemize}
     }
     \item[$\ddag$]
     All the \code{*.mat} files will be produced by \bcode{twosectors\_ces.m}.
     \item[$\diamondsuit$]
     Notation (!\#) stands for ``un-numbered.''
\end{tablenotes}
\end{threeparttable}
\end{table}

\begin{enumerate}
    \item
    Table A.1 is produced by the second part of \bcode{Descriptive.R}. All numbers are printed to the terminal.
    \item
    Figure B.1 is generated by Section 1 of \bcode{Empirical\_Appendix.R}. The four panels are saved respectively as \bcode{./Empirical/Results/FigureB1\_TopLeft.pdf}, \bcode{FigureB1\_TopRight.pdf}, \\ \bcode{FigureB1\_BotLeft.pdf} and \bcode{FigureB1\_BotRight.pdf}.
    \item
    Section 2 of \bcode{Empirical\_Appendix.R} produces the results in Appendix C.1. The beginning of that section first runs the regression of intensity to size by industry. The regression results are printed to the terminal, which are exactly the results reported in Table C.1. The five panels of Figure C.1 are then exported to \bcode{./Empirical/Results/} with the names \bcode{FigureC1\_TopLeft.pdf}, \\ \bcode{FigureC1\_TopRight.pdf}, \bcode{FigureC1\_MidLeft.pdf}, \bcode{FigureC1\_MidRight.pdf} and \\ \bcode{FigureC1\_BotLeft.pdf}. Notice that the bottom-right panel is simply Figure 1 in the main text. The code then repeats the exercise for the manufacturing sector as a whole. Results of the un-numbered regressions on Pages 7, 9 and 10 (the last one) are then printed to the terminal, with Figure C.2 exported to \bcode{./Empirical/Results/FigureC2.pdf}.

    The three un-numbered regressions on the intensity-size relationship by the type of equipment are estimated in Section 2 of \bcode{Empirical\_AEJ.R}.
    \item
    The three panels of Figure D.1 are produced by Section 4 of \bcode{Empirical\_Appendix.R}. The figures are exported as \bcode{./Empirical/Results/FigureD1\_TopLeft.pdf}, \bcode{FigureD1\_TopRight} and \bcode{FigureD1\_Bot.pdf}.
    \item
    Figure D.2 is generated by the last part of \bcode{misc.m}. This requires the results from the benchmark case \bcode{./Quantitative/Results/benchmark\_new.mat}. The file that hosts this figure would be \\ \bcode{./Quantitative/Results/FigureD2.eps}.
    \item
    Results in Appendix D.2 are computed by Section 3 of \bcode{Empirical\_Appendix.R}. Specifically, the 4 panels of Figures D.3 are first plotted and saved as \bcode{./Empirical/Results/FigureD3\_TopLeft.pdf}, \bcode{FigureD3\_TopRight.pdf}, \bcode{FigureD3\_BotLeft.pdf} and \bcode{FigureD3\_BotRight.pdf}. A series of results are then printed to the terminal: first are the in-text numbers of the mean of the ratio of adoption cost to output for firms with output in each quintile (22\%, 11\%, 6.7\%, 5.0\% and 2.7\%), second the coefficients of the un-numbered regression, with the results of Table D.3 come at last.
    \item
    Panels in Figure E.1 are produced by Section 5 of \bcode{Empirical\_Appendix.R}. The five panels are saved as \bcode{./Empirical/Results/FigureE1\_TopLeft.pdf}, \bcode{FigureE1\_TopRight.pdf}, \\ \bcode{FigureE1\_MidLeft.pdf}, \bcode{FigureE1\_MidRight.pdf} and \bcode{FigureE1\_BotLeft.pdf}. Similarly as for Figure C.1, the bottom-right panel is simply the left panel of Figure 2 in the main text.
    \item
    The accounting exercises in Appendix F are performed by \bcode{Accounting.R}. Variables \code{pmed}, \code{preg} and \code{ppar} are respectively for Rows 1, 2 and 3 in Table F.1.
    \item
    Finally, to reproduce Table J.1, one essentially follows the same logic as in the main text: namely execute \bcode{twosectors\_ces.m} many times with different parameter values, print the raw numbers for the corresponding table entries and then manually compute the percentage changes in Table J.1. There are two cases in general, where CES $=$ 1.5 and CES $=$ 3.0. There are three parameters that are ``CES-specific:'' \code{sigmaces}, \code{ke} and \code{varces}. They are conveniently grouped together in the code, under the snippet \bcode{\% CES = 1.5} and  \bcode{\% CES = 3.0}. The reader would also need to modify \code{tauzd} and \code{tauzc} for different scenarios. As before, all the statements have been coded; and the reader only needs to comment and un-comment the relevant snippets of the code. Likewise, the instruction to save the results at the end of the file also needs to be changed. One complication is that the reader needs to set the initial guess for the market clearing prices. For each case, the initial guesses are conveniently stored in the code snippets at the beginning of Section \code{Solve the equilibrium wage}. The program is reasonably robust to different initial guesses. However, if the readers do not use the exact initial guess we use, there may be very minor numerical difference for some of the variables. Similarly, if the reader uses other versions of MATLAB (we use 2016a) or Octave, such numerical errors would probably show up as well.
    \begin{enumerate}
        \item
        By default, \bcode{twosectors\_ces.m} is tuned to produce the benchmark results with CES $=$ 1.5. Executing the file would print some information to the terminal, again please refer to the log file \bcode{quantitative\_ces\_log.pdf} for detail. The equilibrium results are then saved under \\ \bcode{./Quantitative/Results/benchmark\_ces.mat}. This case is called benchmark.
        \item
        Set \code{tauzd} to zero and leave \code{tauzc} untouched, change the initial guesses and the export destination. The results for eliminating only the distortions in the polluting sector would be saved under \bcode{./Quantitative/Results/nodirty\_ces.mat}. This is Case (ii) in Appendix J.
        \item
        Set both \code{tauzd} and \code{tauzc} to zero, change the initial guesses and the export destination. The results for the no distortion case would be saved under \\ \bcode{./Quantitative/Results/notax\_ces.mat}. This case is labeled as Case (i) in Appendix J.
    \end{enumerate}
    \item
    Repeat Step 9 with the parameters set to CES $=$ 3.0 will generate three corresponding \code{.mat} files:
    \begin{itemize}
        \item
        \bcode{./Quantitative/Results/benchmark\_ces3.mat}
        \item
        \bcode{./Quantitative/Results/nodirty\_ces3.mat}
        \item
        \bcode{./Quantitative/Results/notax\_ces3.mat}
    \end{itemize}
    \item
    With all the \code{*.mat} files computed, as before, \bcode{generate\_tables\_appendix} prints Table J.1 to MATLAB terminal. This completes the replication of our paper.
\end{enumerate}

Right before our final submission, we did a final test run on all the programs. We saved all the log files of this particular run in \code{.pdf} format. The correspondence between the log files and the source code is as follows. Once again, to \textit{exactly} replicate what is in these files, the reader needs to use the exact same version of the softwares as we do. The original log files are saved in text files of \code{.log} extension with the same names. For instance, executing the source code \bcode{cpsc\_raw.do} will generate a text log file \bcode{cpsc\_raw.log}, which we converted to \bcode{cpsc\_raw\_log.pdf} manually.
\begin{itemize}
    \item
    \bcode{cpsc\_raw.do} $\longleftrightarrow$ \bcode{cpsc\_raw\_log.pdf}
    \item
    \bcode{cec\_clean.do} $\longleftrightarrow$ \bcode{cec\_clean\_log.pdf}
    \item
    \bcode{cpsc\_convert.R} $\longleftrightarrow$ \bcode{cpsc\_convert\_log.pdf}
    \item
    \bcode{cec\_convert.R} $\longleftrightarrow$ \bcode{cec\_convert\_log.pdf}
    \item
    \bcode{Empirical\_AEJ.R} $\longleftrightarrow$ \bcode{empirical\_main\_log.pdf}
    \item
    \bcode{Empirical\_Appendix.R} $\longleftrightarrow$ \bcode{empirical\_appendix\_log.pdf}
    \item
    \bcode{Descriptive.R} $\longleftrightarrow$ \bcode{descriptive\_log.pdf}
    \item
    \bcode{Accounting.R} $\longleftrightarrow$ \bcode{accounting\_log.pdf}
\end{itemize}
The log files for the quantitative exercises are not automatically generated. We manually copied and pasted the intermediate results sent to the terminal to two text files: \bcode{quantitative\_main.log} for the perfect substitute case in the main text and \bcode{quantitative\_ces.log} for the constant elasticity of substitution case in the appendix. Then we convert the two files to \code{.pdf} format.
\begin{itemize}
    \item
    \bcode{quantitative\_main\_log.pdf} $\longleftrightarrow$ \bcode{quantitative\_main.log}
    \item
    \bcode{quantitaitve\_ces\_log.pdf} $\longleftrightarrow$ \bcode{quantitative\_ces.log}
\end{itemize}

\end{document}
