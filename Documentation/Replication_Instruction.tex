% Article Format: American Economic Review
% Xin Tang @ Stony Brook University
% Last Updated: August 2014
\documentclass[twoside,11pt,leqno]{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Text Layout                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Page Layout
\usepackage[hmargin={1.2in,1.2in},vmargin={1.5in,1.5in}]{geometry}
\topmargin -1cm        % read Lamport p.163
\oddsidemargin 0.04cm   % read Lamport p.163
\evensidemargin 0.04cm  % same as oddsidemargin but for left-hand pages
\textwidth 16.59cm
\textheight 21.94cm
\renewcommand\baselinestretch{1.15}
\parskip 0.25em
\parindent 1em
\linespread{1}

% Set header and footer
\usepackage{fancyhdr}
\pagestyle{fancy}
\fancyhead{}
\fancyhead[LE,RO]{\thepage}
%\fancyhead[CE]{\textit{JI QI, XIN TANG AND XICAN XI}}
%\fancyhead[CO]{\textit{THE SIZE DISTRIBUTION OF FIRMS AND INDUSTRIAL POLLUTION}}
\cfoot{}
\renewcommand{\headrulewidth}{0pt}
%\renewcommand*\footnoterule{}
%\setcounter{page}{1}

% Font
\renewcommand{\rmdefault}{ptm}
\renewcommand{\sfdefault}{phv}
%\usepackage[lite]{mtpro2}
% use Palatinho-Roman as default font family
%\renewcommand{\rmdefault}{ppl}
\usepackage[scaled=0.88]{helvet}
\makeatletter   % Roman Numbers
\newcommand*{\rom}[1]{\expandafter\@slowromancap\romannumeral #1@}
\makeatother
\usepackage{CJK}

% Section Titles
\renewcommand\thesection{\textnormal{\textbf{\Roman{section}.}}}
\renewcommand\thesubsection{\textnormal{\Alph{subsection}.}}
\usepackage{titlesec}
\titleformat*{\section}{\bf \center}
\titleformat*{\subsection}{\it \center}
\renewcommand{\refname}{\textnormal{REFERENCES}}

% Appendix
\usepackage[title]{appendix}
\renewcommand{\appendixname}{APPENDIX}

% Citations
\usepackage[authoryear,comma]{natbib}
\renewcommand{\bibfont}{\small}
\setlength{\bibsep}{0em}
\usepackage[%dvipdfmx,%
            bookmarks=true,%
            pdfstartview=FitH,%
            breaklinks=true,%
            colorlinks=true,%
            %allcolors=black,%
            citecolor=blue,
            linkcolor=red,
            pagebackref=true]{hyperref}

% Functional Package
\usepackage{enumerate}
\usepackage{url}      % This package helps to typeset urls

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                    Mathematics                       %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{amsmath,amssymb,amsfonts,amsthm,mathrsfs,upgreek}
% Operators
\newcommand{\E}{\mathbb{E}}
\newcommand{\e}{\mathrm{e}}
\DeclareMathOperator*{\argmax}{argmax}
\DeclareMathOperator*{\argmin}{argmin}
\DeclareMathOperator*{\plim}{plim}
\renewcommand{\vec}[1]{\ensuremath{\mathbf{#1}}}
\newcommand{\gvec}[1]{{\boldsymbol{#1}}}

\newcommand{\code}{\texttt}
\newcommand{\bcode}[1]{\texttt{\blue{#1}}}
\newcommand{\rcode}[1]{\texttt{\red{#1}}}
\newcommand{\rtext}[1]{{\red{#1}}}
\newcommand{\btext}[1]{{\blue{#1}}}

% New Environments
\newtheorem{result}{Result}
\newtheorem{assumption}{Assumption}
\newtheorem{proposition}{Proposition}
\newtheorem{lemma}{Lemma}
\newtheorem{corollary}{Corollary}
\newtheorem{definition}{Definition}
\setlength{\unitlength}{1mm}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 Tables and Figures                   %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{threeparttable,booktabs,multirow,array} % This allows notes in tables
\usepackage{floatrow} % For Figure Notes
\floatsetup[table]{capposition=top}
\usepackage[font={sc,footnotesize}]{caption}
\DeclareCaptionLabelSeparator{aer}{---}
\captionsetup[table]{labelsep=aer}
\captionsetup[figure]{labelsep=period}
\usepackage{graphicx,pstricks,epstopdf}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%                 Insert Code Snippet                  %
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\usepackage{listings,textcomp,upquote}
\lstset{
     language=fortran,
     frame = single,
%     backgroundcolor=\color[RGB]{255,228,202}, % pink
     backgroundcolor=\color[RGB]{231,240,233}, % green
%     backgroundcolor=\color[RGB]{239,240,248},
     framerule=0pt,
     showstringspaces=false,
     basicstyle=\ttfamily\footnotesize,
     numbers=left,
     stepnumber=1,
     numberstyle=\tiny,
     keywordstyle=\color{blue}\ttfamily,
     stringstyle=\color{red}\ttfamily,
     commentstyle=\color[rgb]{.133,.545,.133}\ttfamily,
     morecomment=[l][\color{magenta}]{\#},
     fontadjust,
     captionpos=t,
     framextopmargin=2pt,framexbottommargin=2pt,
     abovecaptionskip=4ex,belowcaptionskip=3pt,
     belowskip=3pt,
     framexleftmargin=4pt,
     xleftmargin=4em,xrightmargin=4em,
     texcl=false,
     extendedchars=false,columns=flexible,mathescape=true,
     captionpos=b,
}
\renewcommand{\lstlistingname}{Source Code}

\title{\vspace{-1cm}\Large{\textsf{The Size Distribution of Firms and Industrial Water Pollution: A Quantitative Analysis of China} \\ \textsf{Replication Instruction}}}
\author{\normalsize\textsc{Xin Tang} \\ \normalsize\textsc{International Monetary Fund}}
\date{\normalsize\today}

\begin{document}
\maketitle

This note explains step-by-step how to replicate all the results in \textit{The Size Distribution of Firms and Industrial Water Pollution: A Quantitative Analysis of China}. We begin with some housekeeping stuff in Section \rom{1}. Section \rom{2} explains in detail how to replicate all the empirical results. Section \rom{3} shows how the quantitative results can be replicated. 

\section{Housekeeping Stuff}

\subsection{Overview}

To replicate all the results in the paper, three softwares are used. Specifically, \textsc{Stata} is used for initial data processing. All the empirical results are then produced using \code{R}. MATLAB is used to compute all the quantitative results. There is no particular scientific reason that we use one statistical software (\textsc{Stata}) for data cleaning and the other (\code{R}) for empirical analysis.\footnote{Due to limited backward compatibility of \textsc{Stata} and that the \code{foreign} package of \code{R} supports only \code{.dta} files saved by \textsc{Stata} up to Version 12, to run the code without any modification, the reader would need \textsc{Stata} 12. Readers with more recent version of the \textsc{Stata} would need to either modify in the \code{.do} file everywhere \code{.dta} files are read and written, or use alternative \code{R} package (for instance \code{readstata13}) to convert the data in \code{cpsc\_convert.R} and \code{cec\_convert.R}. Compatibility of our code is not tested under such environments though. None of our results would be affected though.} We do this simply because it is easier to handle Chinese characters with \textsc{Stata} while \code{R} switches back and forth between different datasets swiftly. Veterans of \textsc{Stata} (or \code{R}) should be able to replicate all the empirical results with just one software using our source code as reference with ease. In addition, which in fact should go without saying, for readers without a licence to MATALB, GNU Octave could be used instead.

We use three datasets in our analysis: The National General Survey of Pollution Sources (NGSPS, \begin{CJK}{GBK}{kai}第一次全国污染源普查\end{CJK}), The National Economic Census (CNEC, \begin{CJK}{GBK}{kai}第一次全国经济普查\end{CJK}) and the Statistics of U.S. Businesses (SUSB).
\begin{itemize}
    \item
    The NGSPS is a confidential dataset housed at the Ministry of Ecology and Environment. The data can only be accessed within the Ministry of Ecology and Environment as well as institutions under its direct supervision. Individual researchers requesting access should submit the application through the official portal for Information Access (\begin{CJK}{GBK}{kai}政府信息公开\end{CJK}) by the Ministry of Ecology and Environment at the following url: \url{http://www.mee.gov.cn/weihu/201706/t20170625_416641.shtml}. The url is retrieved on September 15th, 2019 and may vary in the future. All applications are subject to official approval by the Ministry of Ecology and Environment.
    \item
    The CNEC is also a confidential dataset belonging to National Bureau of Statistics of China. Many universities and institutions have legal copy of the dataset. Our copy was obtained from Wuhan University. One portal to request access to the data for individual researchers is through the Micro-data Lab of the National Bureau of Statistics (\begin{CJK}{GBK}{kai}国家统计局微观数据实验室，国家统计局-清华大学数据开发中心\end{CJK}). The url, retrieved on September 15th, 2019, is \url{http://microdata.stats.gov.cn/}; and again it may vary in the future. All applications are subject to official approval by the National Bureau of Statistics.
    \item
    The SUSB is publicly available from the Census Bureau's dedicated website. The url, retrieved on September 15th, 2019, and subject to possible change in the future, is \url{https://www.census.gov/programs-surveys/susb.html}.
\end{itemize}

In the replication files, we cannot provide micro-level data of the NGSPS, due to the Non-Disclosure Agreement with the Ministry of Ecology and Environment. Therefore, we only post the source code that generates the results. The NGSPS is used to compute the following results:
\begin{itemize}
    \item
    Tables: 1, 2, A.1, C.1, D.1 and F.1.
    \item
    Figures: 1, B.1 (upper panels), C.1, C.2, D.3.
    \item
    Regressions: 1 and the un-numbered one in Section \rom{1}.B, 2, 3, the 6 un-numbered regression in Appendix C.1 and the un-numbered regression in Appendix D.2.
    \item
    Some miscellaneous information scattered across the paper.
\end{itemize}
The rest of the results can all be replicated by following this guide.

\subsection{File Structures}

The readers will get a number of files for replicating the results. To ease digestion, we briefly introduce the structure of the folders and files. As typographical convention, we use \bcode{blue computer modern typewriter} to indicate \bcode{folders}, and \code{black computer modern typewriter} to label \code{files}. The current folder is referred to as \code{./}.
\begin{itemize}
    \item
    \bcode{./Empirical/}:
    \begin{itemize}
        \item
        \bcode{./Data/}
        \item
        \bcode{./Results/}
        \item
        \code{./cpsc\_raw.do}
        \item
        \code{./cec\_clean.do}
        \item
        \code{./cpsc\_convert.R}
        \item
        \code{./cec\_convert.R}
        \item
        \code{./Empirical\_AEJ.R}
        \item
        \code{./Empirical\_Appendix.R}
        \item
        \code{./Accounting.R}
    \end{itemize}
    \item
    \bcode{./Quantitative/}
    \begin{itemize}
        \item
        \bcode{./Results/}
        \item
        \bcode{./Figures/}
        \item
        \code{./twosectors.m}
        \item
        \code{./fcn2.m}
        \item
        \code{./compute\_tables.m}
        \item
        \code{./plot\_figures.m}
        \item
        \code{./twosectors\_ces.m}
        \item
        \code{./fcnces.m}
        \item
        \code{./compute\_tables\_ces.m}
        \item
        \code{./misc.m}
    \end{itemize}
\end{itemize}

We try to group results according to their order of appearance in the paper. But this is not possible all the time. To ease the navigation, Table summarizes the results in the paper and in which file they are replicated. Acronym: \code{KEYFIRM\_R.RData (PK)}, \code{ALLFIRM\_R.RData (PA)}, \code{DLARGE\_R.RData (DL)} \code{CNEC\_avgp.RData (CA)}, \code{susb04.csv (US)}.
\begin{table}[t]
\footnotesize
\centering
\begin{threeparttable}
\caption{Navigating the Main Text}
\begin{tabular}{llll}
    \hline \hline
    Content                         & File Name                 & File Dependency   & Location in Code \\
    \midrule
    \textbf{Section \rom{1}.A} \\
    \ \ \ Table 1                   & \code{Descriptive.R}      & \code{PK, PA} \\ 
    \textbf{Section \rom{1}.B} \\
    \ \ \ Figure 1                  & \code{Empirical\_AEJ.R}   & \code{PK}         & Section 1  \\
    \ \ \ Table 2                   & \code{Empirical\_AEJ.R}   & \code{PK}         & Section 2  \\
    \ \ \ Regression 1              & \code{Empirical\_AEJ.R}   & \code{PK}         & Section 1  \\
    \ \ \ Regressions 2, 3          & \code{Empirical\_AEJ.R}   & \code{PK}         & Section 2 \\
    \ \ \ Regression (!\#)          & \code{Empirical\_AEJ.R}   & \code{PK}         & Section 2 \\
    \textbf{Section \rom{1}.C} \\
    \ \ \ Figure 2                  & \code{Empirical\_AEJ.R}   & \code{CA, US}     & Section 3 \\
    \ \ \ Accounting                & \code{Accounting.R}       & \code{PK, CA, US} \\
    \textbf{Section \rom{2}.A} \\
    \ \ \ Figure 3                  & \code{Empirical\_AEJ.R}   & \code{CA}         & Section 4 \\
    \ \ \ Figure 4                  & Illustrative figure. \\
    \textbf{Section \rom{3}} \\
    \ \ \ Size Distribution         & \code{Empirical\_AEJ.R}   & \code{CA, US}     & Section 3 \\
    \ \ \ $\varphi_1$               & \code{Empirical\_AEJ.R}   & \code{CA} & Section 4 \\
    \ \ \ Clean share               & \code{Empirical\_AEJ.R}   & \code{PK} & Section 2 \\
    \ \ \ $k_E/Y$ for clean firms   & \code{Empirical\_AEJ.R}   & \code{PK} & Section 2 \\
    \ \ \ Figure 5                  & \code{twosectors.m}       & \multirow{2}{*}{\centering \code{*.mat}} \\ 
                                    & \code{plot\_figures.m} \\
    \textbf{Section \rom{4}.A} \\    
    \ \ \ Table 4                   & \code{compute\_tables.m}  & \code{*.mat} \\ 
    \ \ \ Table 5                   & \code{compute\_tables.m}  & \code{*.mat} \\ 
    \ \ \ Figure 6                  & \code{plot\_figures.m}    & \code{*.mat} \\
    \ \ \ Decomposition             & \code{misc.m}             & \code{*.mat} \\
    \textbf{Section \rom{4}.B} \\
    \ \ \ Table 6                   & \code{compute\_tables.m}  & \code{*.mat} \\ 
    \ \ \ Decomposition             & \code{misc.m}             & \code{*.mat} \\    
    \bottomrule
\end{tabular}
\label{tab:navi}
\end{threeparttable}
\end{table}

\begin{table}[t]
\footnotesize
\centering
\begin{threeparttable}
\caption{Navigating the Appendix}
\begin{tabular}{llll}
    \hline \hline
    Content                         & File Name                      & File Dependency   & Location in Code \\
    \midrule
    \textbf{Appendix A.1} \\
    \ \ \ Table A.1                 & \code{Descriptive.R}           & \code{PK, PA} \\
    \textbf{Appendix B} \\
    \ \ \ Figure B.1                & \code{Empirical\_Appendix.R}   & \code{PK, PA, DL, CA}  & Section 1  \\
    \textbf{Appendix C.1} \\    
    \ \ \ Figure C.1                & \code{Empirical\_Appendix.R}   & \code{PK}  & Section 2  \\
    \ \ \ Table C.1              & \code{Empirical\_Appendix.R}   & \code{PK}  & Section 2  \\
    \ \ \ Figure C.2          & \code{Empirical\_Appendix.R}   & \code{PK}  & Section 2  \\
    \ \ \ Regressions (!\#)          & \code{Empirical\_Appendix.R}   & \code{PK}  & Section 2  \\
    \ \ \ 3-Regressions (!\#) & \code{Empirical\_AEJ.R}   & \code{PK}         & Section 2 \\
    \textbf{Appendix D.1} \\
    \ \ \ Figure D.1            & \code{Empirical\_Appendix.R}   & \code{CA}  & Section 4  \\
    \ \ \ Figure D.2                & \code{misc.m}       \\
    \textbf{Appendix D.2} \\
    \ \ \ Table D.1                  & \code{Empirical\_Appendix.R}   & \code{PK}  & Section 3  \\
    \ \ \ Regression (!\#)           & \code{Empirical\_Appendix.R}   & \code{PK}  & Section 3  \\
    \ \ \ Fixed Cost Ratio & \code{Empirical\_Appendix.R}   & \code{PK}  & Section 3  \\
    \textbf{Appendix E.1} \\
    \ \ \ Figure E.1         & \code{Empirical\_Appendix.R}   & \code{CA, US}  & Section 5  \\
    \textbf{Appendix F} \\    
    \ \ \ Table F.1               & \code{Accounting.R}   & \code{PK, CA, US}  \\
    \textbf{Appendix J} \\
    \ \ \ Table J                  & \code{twosectors\_ces.m}       & \multirow{2}{*}{\centering \code{*.mat}} \\
                                    & \code{compute\_tables\_ces.m} \\
    \bottomrule
\end{tabular}
\label{tab:navi}
\end{threeparttable}
\end{table}

\subsection{Data Cleaning}

\section{Empirical Results}

The instructions are organized by logic instead of the order of appearance in the paper.

\section{Quantitative Results}

\begin{enumerate}
    \item
    set \code{twosectors.m} to benchmark and run
    \item
    set \code{twosectors.m} to no tax and run
    \item
    set \code{twosectors.m} to regulation and run
    \item
    set \code{twosectors.m} to flat tax and run
    \item
    run \code{plot\_figures.m}
    \item
    set \code{compute\_tables.m} to benchmark and run
    \item
    set \code{compute\_tables.m} to no tax and run
    \item
    set \code{compute\_tables.m} to regulation and run
    \item
    set \code{compute\_tables.m} to flat tax and run
    \item
    manually compute the numbers for the tables
\end{enumerate}

\end{document}
