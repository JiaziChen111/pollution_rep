for (i in 1:(NUS-1)){
sel <- which(CHp$product >= CHleft07[i] & CHp$product <= CHright07[i])
selp[i] <- length(sel)
med_int[i] <- quantile(CHp$intensity[sel],probs= 0.5)
}
sel <- which(CHp$product >= CHleft07[NUS])
selp[NUS] <- length(sel)
med_int[NUS] <- quantile(CHp$intensity[sel],probs= 0.5)
pchn <- sum(med_int*distchn)
pus <- sum(med_int*distus)
pmed_chem <- pus/pchn
############# Piecewise Linear Estimation ###################
CHleftn <- USleft
CHrightn <- USright
for (i in 1:NUS){
sel <- which(CH$nbarworkers >= USleft[i] & CH$nbarworkers <= USright[i])
i_lm <- lm(log(product) ~ log(nbarworkers), data=CH[sel])
tmpa <- summary(i_lm)$coefficients["(Intercept)","Estimate"]
tmpb <- summary(i_lm)$coefficients["log(nbarworkers)","Estimate"]
CHleftn[i] <- exp(tmpa + tmpb*log(USleft[i]))
CHrightn[i] <- exp(tmpa + tmpb*log(USright[i]))
}
CHleftn <- CHleftn*deflator
CHrightn <- CHrightn*deflator
# Calculate new distribution for Chinese firms
distchn1 <- rep(0,NUS)
for (i in 1:(NUS-1)){
sel <- which(CHp$product > CHleftn[i] & CHp$product <= CHrightn[i])
distchn1[i] <- sum(CHp$product[sel])
}
# Last category
sel1 <- which(CHp$product > CHleftn[NUS])
distchn1[NUS] <- sum(CHp$product[sel1])
distchn1 <- distchn1/sum(distchn1)
############# Regressing Intensity ###################
reg_int <- rep(0,NUS)
for (i in 1:NUS){
sel <- which(CHp$product >= CHleftn[i] & CHp$product <= CHrightn[i])
i_lm <- lm(log(intensity) ~ log(product),data = CHp[sel])
tmpa <- summary(i_lm)$coefficients["(Intercept)","Estimate"]
tmpb <- summary(i_lm)$coefficients["log(product)","Estimate"]
reg_int[i] <- exp(tmpa + tmpb*(log(CHleftn[i])+log(CHrightn[i]))/2)
}
pchn1 <- sum(reg_int*distchn1)
pus1 <- sum(reg_int*distus)
preg_chem <- pus1/pchn1
############# Full Parametricc Analysis ###################
y_lm <- lm(log(product) ~ log(nbarworkers), data = CH)
p_lm <- lm(log(intensity) ~ log(product), data = CHp)
tmpa <- summary(y_lm)$coefficients["(Intercept)","Estimate"]
tmpb <- summary(y_lm)$coefficients["log(nbarworkers)","Estimate"]
tmpc <- summary(p_lm)$coefficients["(Intercept)","Estimate"]
tmpd <- summary(p_lm)$coefficients["log(product)","Estimate"]
mid_us <- (USleft+USright)/2
par_int <- exp(tmpc + tmpd*(tmpa + tmpb*log(mid_us)))
# Calculate new distribution for Chinese firms
distchn2 <- rep(0,NUS)
for (i in 1:(NUS-1)){
sel <- which(CH$nbarworkers > USleft[i] & CH$nbarworkers <= USright[i])
distchn2[i] <- sum(CH$nbarworkers[sel])
}
# Last category
sel1 <- which(CH$nbarworkers > USleft[NUS])
distchn2[NUS] <- sum(CH$nbarworkers[sel1])
distchn2 <- distchn2/sum(distchn2)
pus <- sum(par_int*distus)
pch <- sum(par_int*distchn2)
ppar_chem <- pus/pch
# --------------- Beverage Industry ------------------------
# Calculate the CNEC cut-off by production scale
sel <- which(CHNprod$industry_a == 15)
CH <- CHNprod[sel]
# 2-digit sector price deflator, from Brandt etal 2012 JDE
deflator <- 103.80/100.60
for (i in 1:NUS){
sel <- which(CH$nbarworkers >= USleft[i] & CH$nbarworkers <= USright[i])
CHleft[i] <-  quantile(CH$product[sel], probs=quandown, na.rm=TRUE)
CHright[i] <- quantile(CH$product[sel], probs=quanup, na.rm=TRUE)
}
CHleft07 <- CHleft*deflator
CHright07 <- CHright*deflator
# Calculate the polluting intensity
sel <- which(CHNpol$industry_a == 15)
CHp <- CHNpol[sel]
CHp <- within(CHp,intensity <- cod_e/product)
# Calculate the US/China approximated production share
sel <- which(USall$NAICS == 3121)
US <- USall[sel]
sel <- which(US$ENTRSIZE != 1 & US$ENTRSIZE != 6 &  US$ENTRSIZE != 9)
US <- US[sel]
US <- within(US,AVGF <- EMPL/FIRM)
distchn <- rep(0,NUS)
distus <- distchn
for (i in 1:(NUS-1)){
sel <- which(US$AVGF > USleft[i] & US$AVGF <= USright[i])
distus[i] <- sum(US$EMPL[sel])
sel1 <- which(CHp$product > CHleft07[i] & CHp$product <= CHright07[i])
distchn[i] <- sum(CHp$product[sel1])
}
# Last category
sel <- which(US$AVGF > USleft[NUS])
distus[NUS] <- sum(US$EMPL[sel])
distus <- distus/sum(distus)
sel1 <- which(CHp$product > CHleft[NUS])
distchn[NUS] <- sum(CHp$product[sel1])
distchn <- distchn/sum(distchn)
selp <- rep(0,NUS)
############# Median Intensity ###################
med_int <- rep(0,NUS)
for (i in 1:(NUS-1)){
sel <- which(CHp$product >= CHleft07[i] & CHp$product <= CHright07[i])
selp[i] <- length(sel)
med_int[i] <- quantile(CHp$intensity[sel],probs= 0.5)
}
sel <- which(CHp$product >= CHleft07[NUS])
selp[NUS] <- length(sel)
med_int[NUS] <- quantile(CHp$intensity[sel],probs= 0.5)
pchn <- sum(med_int*distchn)
pus <- sum(med_int*distus)
pmed_bever <- pus/pchn
############# Regressing Intensity ###################
reg_int <- rep(0,NUS)
for (i in 1:NUS){
sel <- which(CHp$product >= CHleftn[i] & CHp$product <= CHrightn[i])
i_lm <- lm(log(intensity) ~ log(product),data = CHp[sel])
tmpa <- summary(i_lm)$coefficients["(Intercept)","Estimate"]
tmpb <- summary(i_lm)$coefficients["log(product)","Estimate"]
reg_int[i] <- exp(tmpa + tmpb*(log(CHleftn[i])+log(CHrightn[i]))/2)
}
pchn1 <- sum(reg_int*distchn1)
pus1 <- sum(reg_int*distus)
preg_bever <- pus1/pchn1
############# Full Parametricc Analysis ###################
y_lm <- lm(log(product) ~ log(nbarworkers), data = CH)
p_lm <- lm(log(intensity) ~ log(product), data = CHp)
tmpa <- summary(y_lm)$coefficients["(Intercept)","Estimate"]
tmpb <- summary(y_lm)$coefficients["log(nbarworkers)","Estimate"]
tmpc <- summary(p_lm)$coefficients["(Intercept)","Estimate"]
tmpd <- summary(p_lm)$coefficients["log(product)","Estimate"]
mid_us <- (USleft+USright)/2
par_int <- exp(tmpc + tmpd*(tmpa + tmpb*log(mid_us)))
# Calculate new distribution for Chinese firms
distchn2 <- rep(0,NUS)
for (i in 1:(NUS-1)){
sel <- which(CH$nbarworkers > USleft[i] & CH$nbarworkers <= USright[i])
distchn2[i] <- sum(CH$nbarworkers[sel])
}
# Last category
sel1 <- which(CH$nbarworkers > USleft[NUS])
distchn2[NUS] <- sum(CH$nbarworkers[sel1])
distchn2 <- distchn2/sum(distchn2)
pus <- sum(par_int*distus)
pch <- sum(par_int*distchn2)
ppar_bever <- pus/pch
ppar
ppar <- cat(ppar_paper,ppar_agri,ppar_text,ppar_chem,ppar_bever)
0.43*0.33+0.61*0.15+0.97*0.14+1.01*0.10+0.89*0.04
0.5058/(0.33+0.15+0.14+0.10+0.04)
cod <- 0.33+0.15+0.14+0.1+0.04
0.66*cod + 1*(1-cod)
cod
rm(list = ls())
load("./Data/CNEC_avgp.RData")
CNEC <- CNEC_avgp
rm(CNEC_avgp)
# Drop irregular samples
CNEC <- CNEC[status == 1]
CNEC <- CNEC[product > 0]
CNEC <- CNEC[totcapital > 0]
CNEC <- CNEC[nbarworkers > 0]
CNEC <- CNEC[wage + nonwage > 0]
# Construct categorical variables
CNEC$type_a <- factor(CNEC$type_a)
CNEC$province <- factor(CNEC$province)
CNEC$industry <- factor(CNEC$industry)
CNEC$industry_a <- factor(CNEC$industry_a)
# Calculate new variables
CNEC <- within(CNEC,
{lcomp <- wage + nonwage
age <- 2005 - founding_y
})
# Calculate average factor products
alpha = 0.5376
gamma = 0.93
CNEC <- within(CNEC,
{phik   <- product/totcapital
phil   <- product/lcomp
phil_1 <- product/nbarworkers
phi    <- (phik^alpha)*(phil^(1-alpha))
kappa  <- totcapital/lcomp
z      <- (product/(totcapital^alpha*
lcomp^(1-alpha))^gamma)^(1/(1-gamma))
})
CNEC_RSV = CNEC
sel <- which(CNEC$industry_a == 22 | CNEC$industry_a == 13
| CNEC$industry_a == 15 | CNEC$industry_a == 17
| CNEC$industry_a == 26)
CNEC <- CNEC[sel]
CNEC_NPOL <- CNEC_RSV[-sel]
# now CNEC is polluting industries
qup <- quantile(CNEC$phi, probs=c(.975),na.rm=TRUE)
qdown <- quantile(CNEC$phi, probs=c(0.025),na.rm=TRUE)
sel <- which(CNEC$phi>qdown & CNEC$phi<qup)
CNEC_TRIM <- CNEC[sel]
qup <- quantile(CNEC_TRIM$z, probs=c(.975),na.rm=TRUE)
qdown <- quantile(CNEC_TRIM$z, probs=c(0.025),na.rm=TRUE)
sel <- which(CNEC_TRIM$z>qdown & CNEC_TRIM$z<qup)
CNEC_TRIM <- CNEC_TRIM[sel]
CNEC_TRIM <- within(CNEC_TRIM,
{logzratio <- log(z)/(mean(log(z),na.rm = TRUE))
logphiratio <- log(phi)/(mean(log(phi),na.rm = TRUE))
})
# Calculate quintiles
cutoff <- seq(from = 0.01, to = 0.99, by = 0.04)
qcut <- quantile(CNEC_TRIM$logzratio, probs = cutoff, na.rm = TRUE)
n1 <- length(cutoff)
zplot <- rep(0,n1-1)
zplotraw <- zplot
phiplot <- zplot
phiplotraw <- zplot
for (i in 2:n1){
sel <- which(CNEC_TRIM$logzratio > qcut[i-1]
& CNEC_TRIM$logzratio <= qcut[i])
zplot[i-1] <-
sum(CNEC_TRIM$logzratio[sel]*CNEC_TRIM$product[sel])/
sum(CNEC_TRIM$product[sel])
zplotraw[i-1] <- mean(CNEC_TRIM$logzratio[sel])
phiplot[i-1] <-
sum(CNEC_TRIM$logphiratio[sel]*CNEC_TRIM$product[sel])/
sum(CNEC_TRIM$product[sel])
phiplotraw[i-1] <- mean(CNEC_TRIM$logphiratio[sel])
}
# ==================== Figure 3 ============================================
pdf("./Results/Figure3_Left.pdf",height=5,width=5)
plot(phiplot~zplot,cex=0.5,mgp=c(1.75, 0.75, 0),
xlab="Log Productivity",ylab="Log AFP",
main="Average Factor Product: \n Polluting Sector",
cex.main=1.5,cex.lab=1.5,
type = "l",lwd=4,col="deepskyblue4")
dev.off()
# now CNEC is non-polluting industries
CNEC <- CNEC_NPOL
qup <- quantile(CNEC$phi, probs=c(.975),na.rm=TRUE)
qdown <- quantile(CNEC$phi, probs=c(0.025),na.rm=TRUE)
sel <- which(CNEC$phi>qdown & CNEC$phi<qup)
CNEC_TRIM <- CNEC[sel]
qup <- quantile(CNEC_TRIM$z, probs=c(.975),na.rm=TRUE)
qdown <- quantile(CNEC_TRIM$z, probs=c(0.025),na.rm=TRUE)
sel <- which(CNEC_TRIM$z>qdown & CNEC_TRIM$z<qup)
CNEC_TRIM <- CNEC_TRIM[sel]
CNEC_TRIM <- within(CNEC_TRIM,
{logzratio <- log(z)/(mean(log(z),na.rm = TRUE))
logphiratio <- log(phi)/(mean(log(phi),na.rm = TRUE))
})
# Calculate quintiles
cutoff <- seq(from = 0.01, to = 0.99, by = 0.04)
qcut <- quantile(CNEC_TRIM$logzratio, probs = cutoff, na.rm = TRUE)
n1 <- length(cutoff)
zplot <- rep(0,n1-1)
zplotraw <- zplot
phiplot <- zplot
phiplotraw <- zplot
for (i in 2:n1){
sel <- which(CNEC_TRIM$logzratio > qcut[i-1]
& CNEC_TRIM$logzratio <= qcut[i])
zplot[i-1] <-
sum(CNEC_TRIM$logzratio[sel]*CNEC_TRIM$product[sel])/
sum(CNEC_TRIM$product[sel])
zplotraw[i-1] <- mean(CNEC_TRIM$logzratio[sel])
phiplot[i-1] <-
sum(CNEC_TRIM$logphiratio[sel]*CNEC_TRIM$product[sel])/
sum(CNEC_TRIM$product[sel])
phiplotraw[i-1] <- mean(CNEC_TRIM$logphiratio[sel])
}
# ==================== Figure 3 ============================================
pdf("./Results/Figure3_Right.pdf",height=5,width=5)
plot(phiplot~zplot,cex=0.5,mgp=c(1.75, 0.75, 0),
xlab="Log Productivity",ylab="Log AFP",
main="Average Factor Product: \n Non-Polluting Sector",
cex.main=1.5,cex.lab=1.5,
type = "l",lwd=4,col="deepskyblue4")
dev.off()
# Author:
#     - Xin Tang @ International Monetary Fund
#
# Record of Revisions:
#          Date:                 Description of Changes
#    ============        =================================
#       04/06/2019                 Original Version
#       09/17/2019                Improved Annotation
# ==========================================================================
# Clear memory
rm(list = ls())
library(foreign)
library(data.table)
library(AER)
library(scales)
library(grid)
# ==========================================================================
#         1. Firm Size Distribution in Different Datasets
# ==========================================================================
# ====================== Figure B.1 ========================================
# Distribution of output for NGSPS (Key/All), CNEC (All/Large)
# Read the full sample of CNEC
load("./Data/CNEC_avgp.RData")
CHNprod <- CNEC_avgp
rm(CNEC_avgp)
# Drop missing values
sel <- which(CHNprod$product > 0)
CHNprod <- CHNprod[sel]
# CNEC records output in 2004 CNY 1000, but NGSPS records output
#   in 2007 CNY 10,000.
deflator <- 96.30/93.50
CHNprod$rproduct <- (CHNprod$product/10.0)*deflator
tmpden <- density(log(CHNprod$rproduct),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
plot(tmpden,xlab="Log Output",ylab="Density",main="CNEC All",
xlim = c(0, 12), ylim=c(0,0.5), cex.lab = 1.25,
lwd = 2.0, col = 4)
rm(list = ls())
# Load in packages
library(foreign)
library(data.table)
library(AER)
library(scales)
library(grid)
# ==========================================================================
#         1. Firm Size Distribution in Different Datasets
# ==========================================================================
# ====================== Figure B.1 ========================================
# Distribution of output for NGSPS (Key/All), CNEC (All/Large)
# Read the full sample of CNEC
load("./Data/CNEC_avgp.RData")
CHNprod <- CNEC_avgp
rm(CNEC_avgp)
# Drop missing values
sel <- which(CHNprod$product > 0)
CHNprod <- CHNprod[sel]
# CNEC records output in 2004 CNY 1000, but NGSPS records output
#   in 2007 CNY 10,000.
deflator <- 96.30/93.50
CHNprod$rproduct <- (CHNprod$product/10.0)*deflator
tmpden <- density(log(CHNprod$rproduct),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Figures/FigureB1_BotRight.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="CNEC All",
xlim = c(0, 12), ylim=c(0,0.5), cex.lab = 1.25,
lwd = 2.0, col = 4)
dev.off()
# Read the large firms of CNEC
load("./Data/DLARGE_R.RData")
# Drop missing values
sel <- which(DLARGE$product > 0)
DLARGE <- DLARGE[sel]
# Adjusting for inflation and the fact that CNEC records
#     output in CNY 1000.
deflator <- 96.30/93.50
DLARGE$rproduct <- (DLARGE$product/10.0)*deflator
tmpden <- density(log(DLARGE$rproduct),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Figures/FigureB1_BotLeft.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="CNEC Large",
xlim = c(0, 12), ylim=c(0,0.5), cex.lab = 1.25,
lwd = 2.0, col = 4)
dev.off()
# Read the key firms of NGSPS
load("./Data/KEYFIRM_R.RData")
# Drop missing values
sel <- which(KEYFIRM$product > 0)
KEYFIRM <- KEYFIRM[sel]
tmpden <- density(log(KEYFIRM$product),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Figures/FigureB1_TopLeft.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="NGSPS Key",
xlim = c(0, 12), ylim=c(0,0.5), cex.lab = 1.25,
lwd = 2.0, col = 4)
dev.off()
# Read all firms of NGSPS
load("./Data/ALLFIRM_R.RData")
# Drop missing values
sel <- which(ALLFIRM$product > 0)
ALLFIRM <- ALLFIRM[sel]
tmpden <- density(log(ALLFIRM$product),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Figures/FigureB1_TopRight.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="NGSPS All",
xlim = c(0, 12), ylim=c(0,0.5),
cex.lab = 1.25, lwd = 2.0, col = 4)
dev.off()
rm(list = ls())
# Load in packages
library(foreign)
library(data.table)
library(AER)
library(scales)
library(grid)
# ==========================================================================
#         1. Firm Size Distribution in Different Datasets
# ==========================================================================
# ====================== Figure B.1 ========================================
# Distribution of output for NGSPS (Key/All), CNEC (All/Large)
# Read the full sample of CNEC
load("./Data/CNEC_avgp.RData")
CHNprod <- CNEC_avgp
rm(CNEC_avgp)
# Drop missing values
sel <- which(CHNprod$product > 0)
CHNprod <- CHNprod[sel]
# CNEC records output in 2004 CNY 1000, but NGSPS records output
#   in 2007 CNY 10,000.
deflator <- 96.30/93.50
CHNprod$rproduct <- (CHNprod$product/10.0)*deflator
tmpden <- density(log(CHNprod$rproduct),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Results/FigureB1_BotRight.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="CNEC All",
xlim = c(0, 12), ylim=c(0,0.5), cex.lab = 1.25,
lwd = 2.0, col = 4)
dev.off()
# Read the large firms of CNEC
load("./Data/DLARGE_R.RData")
# Drop missing values
sel <- which(DLARGE$product > 0)
DLARGE <- DLARGE[sel]
# Adjusting for inflation and the fact that CNEC records
#     output in CNY 1000.
deflator <- 96.30/93.50
DLARGE$rproduct <- (DLARGE$product/10.0)*deflator
tmpden <- density(log(DLARGE$rproduct),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Results/FigureB1_BotLeft.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="CNEC Large",
xlim = c(0, 12), ylim=c(0,0.5), cex.lab = 1.25,
lwd = 2.0, col = 4)
dev.off()
# Read the key firms of NGSPS
load("./Data/KEYFIRM_R.RData")
# Drop missing values
sel <- which(KEYFIRM$product > 0)
KEYFIRM <- KEYFIRM[sel]
tmpden <- density(log(KEYFIRM$product),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Results/FigureB1_TopLeft.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="NGSPS Key",
xlim = c(0, 12), ylim=c(0,0.5), cex.lab = 1.25,
lwd = 2.0, col = 4)
dev.off()
# Read all firms of NGSPS
load("./Data/ALLFIRM_R.RData")
# Drop missing values
sel <- which(ALLFIRM$product > 0)
ALLFIRM <- ALLFIRM[sel]
tmpden <- density(log(ALLFIRM$product),
kernel = "gaussian", bw =0.50, na.rm = TRUE)
pdf("./Results/FigureB1_TopRight.pdf",height=5,width=5)
plot(tmpden,xlab="Log Output",ylab="Density",main="NGSPS All",
xlim = c(0, 12), ylim=c(0,0.5),
cex.lab = 1.25, lwd = 2.0, col = 4)
dev.off()
rm(list = ls())
load("./Data/KEYFIRM_R.RData")
# ------------ Aggregate ownership rights type ------------------
# 0: missing, 1: State/collective, 3: private, 4: HMT, 5: foreign
KEYFIRM$type_a <- 0
# State and collective
sel <- which(KEYFIRM$type == 110 | KEYFIRM$type == 141
| KEYFIRM$type == 151 | KEYFIRM$type == 120 | KEYFIRM$type == 130
| KEYFIRM$type == 140 | KEYFIRM$type == 150 | KEYFIRM$type == 142
| KEYFIRM$type == 143 | KEYFIRM$type == 149 | KEYFIRM$type == 159
| KEYFIRM$type == 160 | KEYFIRM$type == 100 )
KEYFIRM$type_a[sel] <- 1
# Private
sel <- which(KEYFIRM$type == 170 | KEYFIRM$type == 171
| KEYFIRM$type == 172 | KEYFIRM$type == 173
| KEYFIRM$type == 174 | KEYFIRM$type == 190)
KEYFIRM$type_a[sel] <- 3
# Hong Kong, Macau and Taiwan
sel <- which(KEYFIRM$type == 200 | KEYFIRM$type == 210
| KEYFIRM$type == 220 | KEYFIRM$type == 230
| KEYFIRM$type == 240)
KEYFIRM$type_a[sel] <- 4
# Foreign
sel <- which(KEYFIRM$type == 300 | KEYFIRM$type == 310
| KEYFIRM$type == 320 | KEYFIRM$type == 330
| KEYFIRM$type == 340)
KEYFIRM$type_a[sel] <- 5
# ------------ Aggregate treatment technology type ------------------
# For disposal equipment type
KEYFIRM$dm1_code_a <- 0
# Physical
sel <- which(KEYFIRM$dm1_code >= 1000 & KEYFIRM$dm1_code < 2000)
KEYFIRM$dm1_code_a[sel] <- 1
# Chemical
sel <- which(KEYFIRM$dm1_code >= 2000 & KEYFIRM$dm1_code < 3000)
KEYFIRM$dm1_code_a[sel] <- 2
# Physiochemical
sel <- which(KEYFIRM$dm1_code >= 3000 & KEYFIRM$dm1_code < 4000)
KEYFIRM$dm1_code_a[sel] <- 3
# Biological
sel <- which(KEYFIRM$dm1_code >= 4000 & KEYFIRM$dm1_code < 5000)
KEYFIRM$dm1_code_a[sel] <- 4
# Combination
sel <- which(KEYFIRM$dm1_code >= 5000 & KEYFIRM$dm1_code < 6000)
KEYFIRM$dm1_code_a[sel] <- 5
# --------------- Declare dummies -----------------
KEYFIRM$province <- factor(KEYFIRM$province)        # Province
KEYFIRM$industry_a <- factor(KEYFIRM$industry_a)    # 2-digit industry
KEYFIRM$Census_Type <- factor(KEYFIRM$Census_Type)  # key 1, regular 2
KEYFIRM$dm1_code_a <- factor(KEYFIRM$dm1_code_a)    # treatment
KEYFIRM$type_a <- factor(KEYFIRM$type_a)            # ownership rights
KEYFIRM <- KEYFIRM[product > 0 & cod_e > 0]
KEYFIRM$intensity <- with(KEYFIRM, intensity <- cod_e/product)
